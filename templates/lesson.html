{% extends "base.html" %} {% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Video Player Column -->
    <div class="col-lg-8 p-0">
      <div class="video-container bg-dark">
        <div id="videoPlayer" class="embed-responsive embed-responsive-16by9">
          <video id="currentVideo" class="embed-responsive-item" controls>
            <source src="{{ videos[0].url }}" type="video/mp4" />
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
      <div class="bg-light p-3">
        <h2 id="currentVideoTitle">{{ videos[0].title }}</h2>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <button
              class="btn btn-primary"
              id="prevVideo"
              {%
              if
              not
              videos|length
            >
              1 %}disabled{% endif %}>Previous
            </button>
            <button
              class="btn btn-primary"
              id="nextVideo"
              {%
              if
              not
              videos|length
            >
              1 %}disabled{% endif %}>Next
            </button>
          </div>
          {% if not completed %}
          <form
            action="{{ url_for('mark_completed', course_id=lesson.course_id, lesson_id=lesson.id) }}"
            method="post"
          >
            <button type="submit" class="btn btn-success">
              Mark as Completed
            </button>
          </form>
          {% else %}
          <span class="text-success">âœ“ Completed</span>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Sidebar Column -->
    <div
      class="col-lg-4 bg-light p-0"
      style="height: calc(100vh - 56px); overflow-y: auto"
    >
      <div class="p-3">
        <h3>{{ lesson.title }}</h3>
        <p>{{ lesson.content | safe }}</p>
      </div>
      <div class="list-group list-group-flush">
        {% for video in videos %}
        <a
          href="#"
          class="list-group-item list-group-item-action video-link"
          data-url="{{ video.url }}"
          data-title="{{ video.title }}"
        >
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ video.title }}</h5>
            <small>{{ loop.index }}/{{ videos|length }}</small>
          </div>
          <p class="mb-1">Video {{ loop.index }}</p>
        </a>
        {% endfor %} {% if lesson.quiz %}
        <a
          href="#quizModal"
          data-toggle="modal"
          class="list-group-item list-group-item-action"
        >
          <h5 class="mb-1">Quiz</h5>
        </a>
        {% endif %} {% if lesson.assignment %}
        <a
          href="#assignmentModal"
          data-toggle="modal"
          class="list-group-item list-group-item-action"
        >
          <h5 class="mb-1">Assignment</h5>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Quiz and Assignment Modals remain the same -->

<script>
  $(document).ready(function() {
      let currentVideoIndex = 0;
      const videos = {{ videos | tojson | safe }};

      function updateVideo(index) {
          const videoPlayer = document.getElementById('currentVideo');
          videoPlayer.src = videos[index].url;
          videoPlayer.load(); // Important: This reloads the video with the new source
          $('#currentVideoTitle').text(videos[index].title);
          currentVideoIndex = index;
          updateNavigationButtons();
      }

      function updateNavigationButtons() {
          $('#prevVideo').prop('disabled', currentVideoIndex === 0);
          $('#nextVideo').prop('disabled', currentVideoIndex === videos.length - 1);
      }

      $('.video-link').click(function(e) {
          e.preventDefault();
          const index = $(this).index('.video-link');
          updateVideo(index);
      });

      $('#prevVideo').click(function() {
          if (currentVideoIndex > 0) {
              updateVideo(currentVideoIndex - 1);
          }
      });

      $('#nextVideo').click(function() {
          if (currentVideoIndex < videos.length - 1) {
              updateVideo(currentVideoIndex + 1);
          }
      });

      updateNavigationButtons();
  });
</script>
{% endblock %}
